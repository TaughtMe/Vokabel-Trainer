<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lernkarten-App</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lernkarten">
    <!-- Optional: Ein Icon für den Home-Bildschirm. Sie müssten die icon.png-Datei ebenfalls bereitstellen.
    <link rel="apple-touch-icon" href="icon.png"> 
    -->

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .card-front {
            background-color: white;
            color: black;
        }
        .card-back {
            background-color: #f3f4f6;
            color: black;
            transform: rotateY(180deg);
        }
        .box-shadow-hover:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .option-btn.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-4xl mx-auto">
        
        <div id="main-view">
            <header class="text-center mb-8">
                <h1 class="text-4xl font-bold text-slate-900">Lernkarten-App</h1>
                <p class="text-slate-600 mt-2">Vokabeln lernen nach dem Vokabelkasten-Prinzip</p>
            </header>

            <section id="settings-section" class="mb-8 p-6 bg-white rounded-xl shadow-md">
                 <h2 class="text-2xl font-semibold mb-4 text-center">Einstellungen</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                         <h3 class="font-semibold text-center mb-2">Lernmodus</h3>
                         <div class="flex justify-center bg-slate-200 p-1 rounded-lg w-full mx-auto">
                            <button id="mode-classic-btn" class="option-btn w-1/2 p-2 rounded-md font-semibold transition-colors">Klassisch</button>
                            <button id="mode-typing-btn" class="option-btn w-1/2 p-2 rounded-md font-semibold transition-colors">Schreiben</button>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-center mb-2">Lernrichtung</h3>
                        <div class="flex justify-center bg-slate-200 p-1 rounded-lg w-full mx-auto">
                            <button id="direction-both-btn" class="option-btn w-1/3 p-2 rounded-md font-semibold transition-colors text-sm">Beide</button>
                            <button id="direction-front-btn" class="option-btn w-1/3 p-2 rounded-md font-semibold transition-colors text-sm">V->R</button>
                            <button id="direction-back-btn" class="option-btn w-1/3 p-2 rounded-md font-semibold transition-colors text-sm">R->V</button>
                        </div>
                    </div>
                 </div>
            </section>

            <section id="add-card-section" class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h2 class="text-2xl font-semibold mb-4">Neue Lernkarte erstellen</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="front" class="block text-sm font-medium text-slate-700 mb-1">Vorderseite (Frage/Begriff)</label>
                        <textarea id="front" rows="3" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="z.B. What does 'bewältigen' mean?"></textarea>
                    </div>
                    <div>
                        <label for="back" class="block text-sm font-medium text-slate-700 mb-1">Rückseite (Antwort/Definition)</label>
                        <textarea id="back" rows="3" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="z.B. to cope with, to manage"></textarea>
                    </div>
                </div>
                <button id="add-card-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">Lernkarte hinzufügen</button>
            </section>
            
            <section id="data-management-section" class="bg-white p-6 rounded-xl shadow-md mb-8">
                <h2 class="text-2xl font-semibold mb-4">Daten sichern & wiederherstellen</h2>
                 <p class="text-sm text-slate-600 mb-3">Sichere deinen kompletten Lernstand in einer Datei oder stelle ihn aus einer Sicherung wieder her.</p>
                <div class="flex gap-4 mt-4">
                    <button id="export-json-btn" class="w-1/2 bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600 transition-colors">Exportieren</button>
                    <button id="import-json-btn" class="w-1/2 bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors">Importieren</button>
                    <input type="file" id="json-file-input" accept=".json" class="hidden"/>
                </div>
            </section>

            <section id="boxes-section">
                <h2 class="text-2xl font-semibold mb-4 text-center">Deine Vokabelkästen</h2>
                <div id="boxes-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4"></div>
            </section>
        </div>

        <div id="study-view" class="hidden">
            <h2 id="study-view-title" class="text-3xl font-bold text-center mb-6">Lernmodus</h2>
            <div id="card-container" class="perspective-1000 mx-auto w-full max-w-xl h-64 mb-6">
                <div class="card w-full h-full"><div class="card-inner"><div class="card-face card-front"><p id="card-front-text" class="text-2xl text-center"></p></div><div class="card-face card-back"><p id="card-back-text" class="text-xl text-center"></p></div></div></div>
            </div>
            <div id="classic-controls" class="flex flex-col items-center gap-4">
                 <button id="reveal-btn" class="w-full max-w-sm bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">Antwort anzeigen</button>
                 <div id="assessment-buttons" class="hidden w-full max-w-sm flex gap-4">
                     <button id="correct-btn" class="w-1/2 bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">Richtig</button>
                     <button id="incorrect-btn" class="w-1/2 bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">Falsch</button>
                 </div>
            </div>
            <div id="typing-controls" class="flex flex-col items-center gap-4">
                <input type="text" id="answer-input" class="w-full max-w-sm p-3 border border-slate-300 rounded-lg text-center text-lg" placeholder="Antwort eingeben...">
                <button id="check-answer-btn" class="w-full max-w-sm bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">Prüfen</button>
                <div id="feedback-container" class="w-full max-w-sm text-center"></div>
                <button id="next-card-btn" class="hidden w-full max-w-sm bg-slate-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-600">Weiter</button>
            </div>
            <button id="back-to-main-btn" class="mt-4 text-slate-600 hover:text-slate-900 font-medium mx-auto block">Zurück zur Übersicht</button>
            <p id="study-progress" class="text-center mt-4 text-slate-500"></p>
        </div>
        
        <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm w-full"><p id="notification-text" class="text-lg"></p><button id="notification-close-btn" class="mt-4 bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700">OK</button></div></div>
        <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm w-full"><p id="confirmation-text" class="text-lg mb-4"></p><div class="flex justify-center gap-4"><button id="confirm-yes-btn" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700">Ja</button><button id="confirm-no-btn" class="bg-slate-300 text-slate-800 py-2 px-6 rounded-lg hover:bg-slate-400">Nein</button></div></div></div>
    </div>

    <script type="module">
        // --- Globale Variablen ---
        const NUM_BOXES = 5;
        const LOCAL_STORAGE_KEY_CARDS = 'flashcardApp_cards';
        const LOCAL_STORAGE_KEY_MODE = 'flashcardApp_mode';
        const LOCAL_STORAGE_KEY_DIRECTION = 'flashcardApp_direction';

        let allCards = [];
        let studyDeck = [];
        let currentStudyItem = null;
        let confirmationCallback = null;
        let studyMode = 'classic';
        let studyDirection = 'both';

        // --- DOM-Elemente ---
        const mainView = document.getElementById('main-view');
        const studyView = document.getElementById('study-view');
        const frontInput = document.getElementById('front');
        const backInput = document.getElementById('back');
        const addCardBtn = document.getElementById('add-card-btn');
        const boxesContainer = document.getElementById('boxes-container');
        const cardElement = document.querySelector('.card');
        const cardFrontText = document.getElementById('card-front-text');
        const cardBackText = document.getElementById('card-back-text');
        const studyProgress = document.getElementById('study-progress');
        const backToMainBtn = document.getElementById('back-to-main-btn');

        const modeClassicBtn = document.getElementById('mode-classic-btn');
        const modeTypingBtn = document.getElementById('mode-typing-btn');
        const directionBothBtn = document.getElementById('direction-both-btn');
        const directionFrontBtn = document.getElementById('direction-front-btn');
        const directionBackBtn = document.getElementById('direction-back-btn');

        const studyViewTitle = document.getElementById('study-view-title');
        const classicControls = document.getElementById('classic-controls');
        const typingControls = document.getElementById('typing-controls');
        const revealBtn = document.getElementById('reveal-btn');
        const assessmentButtons = document.getElementById('assessment-buttons');
        const correctBtn = document.getElementById('correct-btn');
        const incorrectBtn = document.getElementById('incorrect-btn');
        const answerInput = document.getElementById('answer-input');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const feedbackContainer = document.getElementById('feedback-container');
        const nextCardBtn = document.getElementById('next-card-btn');
        
        const exportJsonBtn = document.getElementById('export-json-btn');
        const importJsonBtn = document.getElementById('import-json-btn');
        const jsonFileInput = document.getElementById('json-file-input');
        
        const notificationModal = document.getElementById('notification-modal');
        const notificationText = document.getElementById('notification-text');
        const notificationCloseBtn = document.getElementById('notification-close-btn');
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmationText = document.getElementById('confirmation-text');
        const confirmYesBtn = document.getElementById('confirm-yes-btn');
        const confirmNoBtn = document.getElementById('confirm-no-btn');

        // --- Initialisierung & Daten-Management ---
        function initializeApp() {
            loadCardsFromLocalStorage();
            loadSettings();
            setupEventListeners();
        }

        function loadCardsFromLocalStorage() {
            const storedCards = localStorage.getItem(LOCAL_STORAGE_KEY_CARDS);
            allCards = storedCards ? JSON.parse(storedCards) : [];
            renderBoxes();
        }

        function saveCardsToLocalStorage() {
            localStorage.setItem(LOCAL_STORAGE_KEY_CARDS, JSON.stringify(allCards));
        }

        function loadSettings() {
            setStudyMode(localStorage.getItem(LOCAL_STORAGE_KEY_MODE) || 'classic');
            setStudyDirection(localStorage.getItem(LOCAL_STORAGE_KEY_DIRECTION) || 'both');
        }

        function setStudyMode(mode) {
            studyMode = mode;
            localStorage.setItem(LOCAL_STORAGE_KEY_MODE, mode);
            modeClassicBtn.classList.toggle('active', mode === 'classic');
            modeTypingBtn.classList.toggle('active', mode === 'typing');
        }

        function setStudyDirection(direction) {
            studyDirection = direction;
            localStorage.setItem(LOCAL_STORAGE_KEY_DIRECTION, direction);
            directionBothBtn.classList.toggle('active', direction === 'both');
            directionFrontBtn.classList.toggle('active', direction === 'front');
            directionBackBtn.classList.toggle('active', direction === 'back');
        }

        // --- UI-Funktionen ---
        function renderBoxes() {
            boxesContainer.innerHTML = '';
            const cardCounts = Array(NUM_BOXES).fill(0);
            allCards.forEach(card => {
                if(card.box >= 1 && card.box <= NUM_BOXES) cardCounts[card.box - 1]++;
            });
            for (let i = 0; i < NUM_BOXES; i++) {
                const boxIndex = i + 1;
                const count = cardCounts[i];
                const boxEl = document.createElement('div');
                boxEl.className = `p-4 bg-white rounded-lg shadow-md text-center transition-all duration-300 ${count > 0 ? 'cursor-pointer box-shadow-hover' : ''}`;
                boxEl.innerHTML = `<h3 class="font-bold text-lg text-slate-800">Kasten ${boxIndex}</h3><p class="text-3xl font-semibold my-2 ${count > 0 ? 'text-blue-600' : 'text-slate-400'}">${count}</p><p class="text-sm text-slate-500 mb-4">Karte${count !== 1 ? 'n' : ''}</p><button data-box="${boxIndex}" class="start-study-btn w-full bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed" ${count === 0 ? 'disabled' : ''}>Lernen</button>`;
                boxesContainer.appendChild(boxEl);
            }
        }
        function showNotification(message) {
            notificationText.textContent = message;
            notificationModal.classList.remove('hidden');
        }
        function showConfirmation(message, callback) {
            confirmationText.textContent = message;
            confirmationCallback = callback;
            confirmationModal.classList.remove('hidden');
        }
        function switchView(viewName) {
            mainView.classList.toggle('hidden', viewName === 'study');
            studyView.classList.toggle('hidden', viewName !== 'study');
        }
        
        // --- App-Logik ---
        function handleAddCard() {
            const front = frontInput.value.trim();
            const back = backInput.value.trim();
            if (!front || !back) return showNotification("Bitte fülle beide Seiten der Karte aus.");
            
            allCards.push({ id: Date.now().toString(), front, back, box: 1, createdAt: new Date().toISOString() });
            saveCardsToLocalStorage();
            renderBoxes();
            frontInput.value = ''; backInput.value = ''; frontInput.focus();
            showNotification("Lernkarte erfolgreich hinzugefügt!");
        }

        function handleExport() {
            if (allCards.length === 0) {
                return showNotification("Es sind keine Karten zum Exportieren vorhanden.");
            }
            const dataStr = JSON.stringify(allCards, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'lernkarten-backup.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function handleJsonFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            showConfirmation("Achtung! Das Importieren überschreibt deinen gesamten aktuellen Lernstand. Fortfahren?", (confirmed) => {
                if (confirmed) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (Array.isArray(importedData)) {
                                allCards = importedData;
                                saveCardsToLocalStorage();
                                renderBoxes();
                                showNotification("Lernstand erfolgreich importiert.");
                            } else { throw new Error("Ungültiges Datenformat."); }
                        } catch (error) { showNotification("Fehler: Die Datei ist beschädigt oder hat ein falsches Format."); }
                    };
                    reader.readAsText(file);
                }
                jsonFileInput.value = '';
            });
        }
        
        function startStudySession(boxNumber) {
            const cardsInBox = allCards.filter(card => card.box === boxNumber);
            if (cardsInBox.length === 0) return showNotification(`Kasten ${boxNumber} ist leer.`);

            studyDeck = [];
            cardsInBox.forEach(originalCard => {
                if (studyDirection === 'front' || studyDirection === 'both') {
                    studyDeck.push({ question: originalCard.front, answer: originalCard.back, originalCardId: originalCard.id });
                }
                if (studyDirection === 'back' || studyDirection === 'both') {
                    studyDeck.push({ question: originalCard.back, answer: originalCard.front, originalCardId: originalCard.id });
                }
            });

            studyDeck.sort(() => Math.random() - 0.5);
            
            setupStudyViewForMode();
            switchView('study');
            showNextStudyItem();
        }

        function setupStudyViewForMode() {
            const isClassic = studyMode === 'classic';
            studyViewTitle.textContent = isClassic ? 'Lernmodus: Klassisch' : 'Lernmodus: Schreiben';
            classicControls.style.display = isClassic ? 'flex' : 'none';
            typingControls.style.display = isClassic ? 'none' : 'flex';
        }

        function showNextStudyItem() {
            cardElement.classList.remove('flipped');
            feedbackContainer.innerHTML = '';
            
            if (studyDeck.length > 0) {
                currentStudyItem = studyDeck.pop();
                cardFrontText.textContent = currentStudyItem.question;
                cardBackText.textContent = currentStudyItem.answer;
                
                if (studyMode === 'classic') {
                    revealBtn.classList.remove('hidden');
                    assessmentButtons.classList.add('hidden');
                } else {
                    answerInput.value = '';
                    answerInput.disabled = false;
                    checkAnswerBtn.classList.remove('hidden');
                    nextCardBtn.classList.add('hidden');
                    answerInput.focus();
                }
                updateStudyProgress();
            } else {
                showNotification("Gut gemacht! Du hast alle Karten in diesem Kasten durchgearbeitet.");
                currentStudyItem = null;
                renderBoxes();
                switchView('main');
            }
        }
        
        function updateStudyProgress() {
            studyProgress.textContent = `Noch ${studyDeck.length} Abfragen in dieser Sitzung`;
        }
        
        function moveCard(originalCardId, wasCorrect) {
            const cardIndex = allCards.findIndex(card => card.id === originalCardId);
            if (cardIndex !== -1) {
                const currentBox = allCards[cardIndex].box;
                const newBox = wasCorrect ? Math.min(NUM_BOXES, currentBox + 1) : 1;
                allCards[cardIndex].box = newBox;
                saveCardsToLocalStorage();
            }
        }
        
        function handleRevealAnswer() {
            cardElement.classList.add('flipped');
            revealBtn.classList.add('hidden');
            assessmentButtons.classList.remove('hidden');
        }

        function handleClassicAssessment(isCorrect) {
            if (!currentStudyItem) return;
            moveCard(currentStudyItem.originalCardId, isCorrect);
            setTimeout(showNextStudyItem, 400);
        }

        function handleCheckAnswer() {
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = currentStudyItem.answer.trim().toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            cardElement.classList.add('flipped');
            answerInput.disabled = true;
            checkAnswerBtn.classList.add('hidden');
            nextCardBtn.classList.remove('hidden');

            if (isCorrect) {
                feedbackContainer.innerHTML = `<p class="text-green-600 font-bold">Korrekt!</p>`;
            } else {
                feedbackContainer.innerHTML = `<p class="text-red-600 font-bold">Leider falsch.</p><p class="text-sm text-slate-600">Richtige Antwort: ${currentStudyItem.answer}</p>`;
            }

            moveCard(currentStudyItem.originalCardId, isCorrect);
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            modeClassicBtn.addEventListener('click', () => setStudyMode('classic'));
            modeTypingBtn.addEventListener('click', () => setStudyMode('typing'));
            directionBothBtn.addEventListener('click', () => setStudyDirection('both'));
            directionFrontBtn.addEventListener('click', () => setStudyDirection('front'));
            directionBackBtn.addEventListener('click', () => setStudyDirection('back'));
            
            addCardBtn.addEventListener('click', handleAddCard);
            exportJsonBtn.addEventListener('click', handleExport);
            importJsonBtn.addEventListener('click', () => jsonFileInput.click());
            jsonFileInput.addEventListener('change', handleJsonFileSelect);

            boxesContainer.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.start-study-btn');
                if (targetButton) startStudySession(parseInt(targetButton.dataset.box, 10));
            });
            
            backToMainBtn.addEventListener('click', () => { currentStudyItem = null; renderBoxes(); switchView('main'); });
            
            revealBtn.addEventListener('click', handleRevealAnswer);
            correctBtn.addEventListener('click', () => handleClassicAssessment(true));
            incorrectBtn.addEventListener('click', () => handleClassicAssessment(false));

            checkAnswerBtn.addEventListener('click', handleCheckAnswer);
            answerInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !checkAnswerBtn.classList.contains('hidden')) handleCheckAnswer();
            });
            nextCardBtn.addEventListener('click', showNextStudyItem);
            
            notificationCloseBtn.addEventListener('click', () => notificationModal.classList.add('hidden'));
            confirmYesBtn.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
                if (confirmationCallback) confirmationCallback(true);
            });
            confirmNoBtn.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
                if (confirmationCallback) confirmationCallback(false);
            });
        }

        window.onload = initializeApp;
    </script>
</body>
</html>
